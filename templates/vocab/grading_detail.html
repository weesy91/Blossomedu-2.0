<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ student_name }} í•™ìƒ ë‹µì•ˆì§€</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f8f9fa; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .table-warning { background-color: #fff3cd !important; } /* ê°•ì¡°ìƒ‰ í™•ì‹¤í•˜ê²Œ */
    </style>
</head>
<body>
    
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4 shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="{% url 'core:teacher_home' %}">Vocabulary Admin</a>
        </div>
    </nav>

    <div class="container py-4" style="max-width: 1000px;">
        
        <div class="d-flex justify-content-between align-items-end mb-4">
            <div>
                <a href="{% url 'vocab:grading_list' %}" class="btn btn-outline-secondary btn-sm mb-2 shadow-sm">
                    <i class="bi bi-arrow-left"></i> ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </a>
                <h3 class="fw-bold mb-1">
                    <span class="text-primary">{{ student_name }}</span> í•™ìƒì˜ ë‹µì•ˆì§€
                </h3>
                <p class="text-muted mb-0 fs-5">
                    ğŸ“– {{ exam.book.title }} <span class="badge bg-light text-dark border ms-2">{{ exam.test_range }}</span>
                </p>
            </div>
            <div class="text-end bg-white p-3 rounded shadow-sm border text-center" style="min-width: 150px;">
                <div class="small text-muted fw-bold text-uppercase">Current Score</div>
                <h1 class="fw-bold text-primary mb-0 display-4">{{ exam.score }}</h1>
            </div>
        </div>

        <div class="card shadow border-0 overflow-hidden">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0 text-center">
                    <thead class="table-light border-bottom">
                        <tr>
                            <th width="5%" class="py-3">#</th>
                            <th width="20%" class="py-3">ë¬¸ì œ (ì˜ì–´)</th>
                            <th width="20%" class="py-3">ì •ë‹µ (ëœ»)</th>
                            <th width="25%" class="py-3">í•™ìƒ ë‹µì•ˆ</th>
                            <th width="10%" class="py-3">ê²°ê³¼</th>
                            <th width="20%" class="py-3 bg-light border-start">ğŸ“ ì •ì • ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for detail in details %}
                        <tr class="{% if detail.is_correction_requested and not detail.is_resolved %}table-warning border-warning border-2{% endif %}">
                            <td class="text-muted">{{ forloop.counter }}</td>
                            <td class="fw-bold text-start ps-4">{{ detail.word_question }}</td>
                            <td class="text-success text-start ps-4">{{ detail.correct_answer }}</td>
                            
                            <td class="text-start ps-4">
                                {% if detail.is_correct %}
                                    <span class="text-primary fw-bold">{{ detail.student_answer }}</span>
                                {% else %}
                                    <span class="text-danger text-decoration-line-through">{{ detail.student_answer }}</span>
                                {% endif %}
                            </td>

                            <td>
                                {% if detail.is_correct %}
                                    <i class="bi bi-check-circle-fill text-success fs-4"></i>
                                {% else %}
                                    <i class="bi bi-x-circle-fill text-danger fs-4"></i>
                                {% endif %}
                            </td>

                            <td class="border-start">
                                {% if detail.is_correction_requested and not detail.is_resolved %}
                                    <div class="d-flex gap-2 justify-content-center">
                                        <button onclick="processAnswer('{{ detail.id }}', 'approve')" 
                                                class="btn btn-success btn-sm shadow-sm fw-bold px-3" title="ì •ë‹µ ì¸ì •">
                                            <i class="bi bi-check-lg"></i> ì¸ì •
                                        </button>
                                        <button onclick="processAnswer('{{ detail.id }}', 'reject')" 
                                                class="btn btn-secondary btn-sm shadow-sm fw-bold px-3" title="ê¸°ê°">
                                            <i class="bi bi-x-lg"></i> ê¸°ê°
                                        </button>
                                    </div>
                                {% elif detail.is_resolved %}
                                    <span class="badge bg-secondary opacity-50">ì²˜ë¦¬ ì™„ë£Œ</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const TEST_TYPE = "{{ test_type }}"; 

        function processAnswer(detailId, action) {
            let msg = action === 'approve' ? 'â­• ì •ë‹µìœ¼ë¡œ ì¸ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì ìˆ˜ê°€ ë³µêµ¬ë©ë‹ˆë‹¤)' : 'âŒ ìš”ì²­ì„ ê±°ì ˆ(ê¸°ê°)í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
            if (!confirm(msg)) return;

            const url = action === 'approve' ? '/vocab/api/approve/' : '/vocab/api/reject/';

            fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    'detail_id': detailId,
                    'type': TEST_TYPE
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    location.reload();
                } else {
                    alert('ì˜¤ë¥˜ ë°œìƒ: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            })
            .catch(err => console.error(err));
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>