<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•™ìƒ ìƒì„¸ ì´ë ¥</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f8f9fa; }
        .header-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; border-radius: 0 0 25px 25px; padding: 25px 20px; margin-bottom: 20px;
        }
        
        /* ğŸ“± ëª¨ë°”ì¼ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        @media (max-width: 768px) {
            .table-custom thead { display: none; }
            .table-custom tbody tr {
                display: block; background: white; margin-bottom: 12px; padding: 15px;
                border-radius: 12px; border: 1px solid #eee;
            }
            .table-custom td { display: block; border: none; padding: 2px 0; }
            
            /* ë‚ ì§œ/ê³¼ëª© í•œ ì¤„ ë°°ì¹˜ */
            .table-custom td:nth-child(1) { 
                font-size: 1.1rem; font-weight: bold; color: #333 !important; margin-bottom: 5px;
            }
            .table-custom td:nth-child(4) {
                color: #888; font-size: 0.9rem; text-align: right; margin-top: -25px; 
            }
        }
    </style>
</head>
<body>

<div class="header-card">
    <div class="d-flex justify-content-between align-items-start">
        <div class="d-flex align-items-center gap-3">
            <div class="bg-white text-primary rounded-circle d-flex align-items-center justify-content-center fw-bold fs-2" style="width: 50px; height: 50px;">
                {{ student.name|slice:":1" }}
            </div>
            <div>
                <h2 class="mb-0 fw-bold">{{ student.name }}</h2>
                <div class="opacity-75 small">
                    {{ student.school.name|default:"-" }} Â· {{ student.current_grade_display }}
                </div>
            </div>
        </div>
        <a href="javascript:history.back()" class="btn btn-outline-light btn-sm rounded-pill px-3">
            <i class="bi bi-arrow-left"></i>
        </a>
    </div>

    <div class="mt-3">
        {% if vocab_days is not None %}
            {% if vocab_days >= 3 %}
                <span class="badge bg-warning text-dark border-0 rounded-pill">
                    âš ï¸ ë‹¨ì–´ {{ vocab_days }}ì¼ì§¸ ë¯¸ì‘ì‹œ
                </span>
            {% else %}
                <span class="badge bg-success bg-opacity-25 border-0 rounded-pill">
                    âœ… ë‹¨ì–´ í•™ìŠµ ì–‘í˜¸
                </span>
            {% endif %}
        {% endif %}
    </div>
</div>

<div class="container px-3 pb-5">
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-3">
            <h6 class="fw-bold mb-3 small text-muted">ìµœê·¼ ì¶œì„ í˜„í™©</h6>
            <div class="d-flex gap-2" style="overflow-x: auto; padding-bottom: 5px;">
                {% for att in attendances|slice:":5" %}
                <div class="text-center p-2 rounded bg-light border" style="min-width: 70px;">
                    <div class="small fw-bold">{{ att.date|date:"n/j" }}</div>
                    <div class="small text-muted mb-1">{{ att.check_in_time|time:"H:i" }}</div>
                    {% if att.status == 'PRESENT' %}
                        <span class="badge bg-success rounded-pill" style="font-size:0.6rem">ì¶œì„</span>
                    {% elif att.status == 'LATE' %}
                        <span class="badge bg-warning text-dark rounded-pill" style="font-size:0.6rem">ì§€ê°</span>
                    {% else %}
                        <span class="badge bg-danger rounded-pill" style="font-size:0.6rem">ê²°ì„</span>
                    {% endif %}
                </div>
                {% empty %}
                <span class="text-muted small">ê¸°ë¡ ì—†ìŒ</span>
                {% endfor %}
            </div>
        </div>
    </div>

    <h5 class="fw-bold mb-3 ms-1">ğŸ“ ìˆ˜ì—… ì¼ì§€</h5>
    {% if logs %}
        <table class="table table-custom">
            <thead>
                <tr>
                    <th>ë‚ ì§œ</th>
                    <th>ê³¼ëª©</th>
                    <th>ë‚´ìš©</th>
                    <th>ì„ ìƒë‹˜</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr onclick="location.href='{% url 'academy:create_class_log' 0 %}?student_id={{ student.id }}&date={{ log.date|date:'Y-m-d' }}&subject={{ log.subject }}'" style="cursor: pointer;">
                    <td class="text-secondary">
                        {{ log.date|date:"n/j (D)" }}
                        {% if log.subject == 'SYNTAX' %}
                            <span class="badge bg-success ms-1" style="font-size:0.7em">êµ¬ë¬¸</span>
                        {% elif log.subject == 'READING' %}
                            <span class="badge bg-warning text-dark ms-1" style="font-size:0.7em">ë…í•´</span>
                        {% endif %}
                    </td>
                    <td></td>
                    <td>
                        {% if log.topic %}
                            <div class="mb-1"><span class="text-primary fw-bold">ì§„ë„:</span> {{ log.topic }}</div>
                        {% endif %}
                        {% if log.hw_range %}
                            <div class="small text-muted"><span class="fw-bold">ìˆ™ì œ:</span> {{ log.hw_range }}</div>
                        {% endif %}
                        {% if log.memo %}
                            <div class="small text-danger mt-1"><i class="bi bi-exclamation-circle me-1"></i>{{ log.memo }}</div>
                        {% endif %}
                    </td>
                    <td>
                        <small>{{ log.teacher.staff_profile.name|default:log.teacher.username }} T</small>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <h5 class="fw-bold mb-3 ms-1 mt-5">ğŸ“– ë‹¨ì–´ ì‹œí—˜ ê¸°ë¡ <span class="small text-muted fw-normal">(ìµœê·¼ 20ê°œ)</span></h5>
    
    {% if vocab_results %}
        <div class="accordion mb-5" id="historyVocabAccordion">
            {% for result in vocab_results %}
            <div class="accordion-item border-0 shadow-sm mb-2 rounded overflow-hidden">
                <h2 class="accordion-header" id="histHeading{{ result.id }}">
                    <button class="accordion-button collapsed p-3 bg-white" type="button" data-bs-toggle="collapse" data-bs-target="#histCollapse{{ result.id }}" aria-expanded="false">
                        <div class="d-flex flex-column w-100">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <span class="fw-bold text-dark">{{ result.book.title }}</span>
                                <span class="badge {% if result.score >= 27 %}bg-success{% else %}bg-danger{% endif %} rounded-pill">
                                    {{ result.score }} / {{ result.total_count }}
                                </span>
                            </div>
                            <div class="d-flex justify-content-between small text-muted">
                                <span>{{ result.created_at|date:"Y.m.d H:i" }}</span>
                                <span>{% if result.score >= 27 %}ğŸ‰ í†µê³¼{% else %}âš ï¸ ì¬ì‹œí—˜{% endif %}</span>
                            </div>
                        </div>
                    </button>
                </h2>
                <div id="histCollapse{{ result.id }}" class="accordion-collapse collapse" data-bs-parent="#historyVocabAccordion">
                    <div class="accordion-body p-0">
                        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                            <table class="table table-sm table-striped mb-0 small text-center align-middle">
                                <thead class="table-light sticky-top">
                                    <tr>
                                        <th width="35%">ë¬¸ì œ</th>
                                        <th width="30%">ì •ë‹µ</th>
                                        <th width="25%">ì œì¶œ</th>
                                        <th width="10%"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for detail in result.details.all %}
                                    <tr>
                                        <td class="fw-bold">{{ detail.word_question }}</td>
                                        <td class="text-start text-truncate" style="max-width: 100px;">
                                            {{ detail.correct_answer }}
                                        </td>
                                        <td class="{% if detail.is_correct %}text-success{% else %}text-danger fw-bold{% endif %}">
                                            {{ detail.student_answer }}
                                        </td>
                                        <td>
                                            {% if detail.is_correct %}
                                                <i class="bi bi-check-circle-fill text-success"></i>
                                            {% else %}
                                                <i class="bi bi-x-circle-fill text-danger"></i>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-5 text-muted bg-light rounded mb-5">
            <i class="bi bi-journal-x fs-1"></i>
            <p class="mt-2">ë‹¨ì–´ ì‹œí—˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    {% endif %}

    {% else %}
        <div class="text-center py-5 text-muted">
            ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
        </div>
    {% endif %}
</div>

</body>
</html>