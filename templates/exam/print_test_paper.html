<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{{ paper.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* [1] ì›¹ í°íŠ¸ */
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap');

        body {
            font-family: 'Nanum Gothic', sans-serif;
            background-color: #525659;
        }

        /* í™”ë©´ìš© ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .page {
            background: white;
            width: 210mm;
            min-height: 297mm;
            margin: 10mm auto;
            padding: 20mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            position: relative;
            box-sizing: border-box;
        }

        /* [í•µì‹¬] ë ˆì´ì•„ì›ƒ ì´ì›í™” */
        /* 1. ë…í•´ìš© (2ë‹¨) */
        .layout-reading {
            column-count: 2;
            column-gap: 15mm;
            width: 100%;
        }
        /* 2. êµ¬ë¬¸ìš© (1ë‹¨ - ê¸°ì¡´) */
        .layout-syntax {
            width: 100%;
        }

        /* ë¬¸ì œ ë©ì–´ë¦¬ */
        .question-block {
            break-inside: avoid;
            page-break-inside: avoid;
            margin-bottom: 10mm;
            display: inline-block; /* 2ë‹¨ ë ˆì´ì•„ì›ƒì—ì„œ ì§¤ë¦¼ ë°©ì§€ */
            width: 100%;
        }

        /* â­ [NEW] êµ¬ì¡°ë¶„ì„(Type S) ì „ìš©: 2ë‹¨ì„ ëš«ê³  ê°€ë¡œ ì „ì²´ ì‚¬ìš© */
        .span-all {
            column-span: all;
            display: block;
            width: 100%;
            margin-top: 10mm;
            margin-bottom: 10mm;
            padding-top: 5mm;
            border-top: 1px dashed #ccc; /* êµ¬ë¶„ì„  ì¶”ê°€ */
        }

        .q-num {
            font-size: 1.2rem;
            font-weight: 800;
            color: #000;
            border-bottom: 2px solid #000;
            display: inline-block;
            margin-bottom: 5px;
            padding-right: 10px;
        }

        .q-img {
            max-width: 100%;
            height: auto;
            display: block;
            margin-bottom: 10px;
        }

        /* Logic Box ìŠ¤íƒ€ì¼ (ë…í•´ìš©) */
        .logic-box {
            font-size: 0.85rem;
            border: 1px solid #aaa;
            padding: 8px;
            border-radius: 4px;
            background-color: #fcfcfc;
            margin-top: 5px;
        }

        /* [2] ì¸ì‡„ìš© ìŠ¤íƒ€ì¼ */
        @media print {
            @page {
                size: A4;
                margin: 10mm; 
            }
            
            body {
                background: white;
                margin: 0;
                padding: 0;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .page {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none;
                border: none;
                page-break-after: always;
            }

            .page:last-child {
                page-break-after: auto;
            }

            .no-print { display: none !important; }
            .no-print-padding { padding-top: 0 !important; }
            
            .row { display: flex !important; flex-wrap: wrap !important; }
            .col-6 { width: 50% !important; flex: 0 0 50% !important; }

            /* ì¸ì‡„ ì‹œ ë°•ìŠ¤ ë°°ê²½ ì œê±° (ì‰í¬ ì ˆì•½) */
            .logic-box { 
                border-color: #000 !important; 
                background-color: white !important; 
            }
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-dark bg-dark fixed-top no-print">
        <div class="container-fluid justify-content-between">
            <span class="navbar-text text-white fw-bold">
                ğŸ“„ {{ paper.title }}
            </span>
            <div>
                <a href="javascript:history.back()" class="btn btn-secondary btn-sm me-2">ë’¤ë¡œê°€ê¸°</a>
                <button onclick="window.print()" class="btn btn-primary btn-sm fw-bold">
                    ğŸ–¨ï¸ PDF ì €ì¥ / ì¸ì‡„
                </button>
            </div>
        </div>
    </nav>

    <div style="padding-top: 60px;" class="no-print-padding"> 
        
        <div class="page d-flex flex-column justify-content-center align-items-center text-center">
            <div style="border: 3px double #333; padding: 50px; width: 80%;">
                <h1 class="display-4 fw-bold mb-4">MONTHLY TEST</h1>
                <h2 class="mb-5 fw-bold">{{ paper.title }}</h2>
                <hr class="my-5">
                <table class="table table-bordered mb-0">
                    <tr>
                        <th class="bg-light w-25 align-middle">ì´ë¦„</th>
                        <td class="fs-3 fw-bold py-3">{{ paper.student.name }}</td>
                    </tr>
                    <tr>
                        <th class="bg-light align-middle">ì ìˆ˜</th>
                        <td class="fs-3 fw-bold py-3" style="color:#ddd;">       / {{ paper.questions.count }}</td>
                    </tr>
                </table>
            </div>
            <div class="mt-5 text-muted">
                <p>Date: {% now "Y. m. d" %}</p>
                <p class="small">Blossom Edu English Academy</p>
            </div>
        </div>

        <div class="page">
            <div class="d-flex justify-content-between border-bottom border-2 border-dark mb-4 pb-2">
                <h4 class="fw-bold m-0">Questions</h4>
                <span class="text-muted">{{ paper.title }}</span>
            </div>

            <div class="{% if questions.0.category == 'READING' %}layout-reading{% else %}layout-syntax{% endif %}">
                
                {% for q in questions %}
                    <div class="question-block {% if q.reading_type == 'STRUCT' %}span-all{% endif %}">
                        
                        <div class="q-num">Q{{ forloop.counter }}.</div>
                        
                        {% if q.image %}
                            <img src="{{ q.image.url }}" class="q-img">
                        {% else %}
                            <div class="alert alert-warning p-2">ì´ë¯¸ì§€ ì—†ìŒ ({{ q.question_text }})</div>
                        {% endif %}

                        {% if q.category == 'READING' %}
                            
                            {% if q.reading_type != 'STRUCT' %}
                                <div class="logic-box">
                                    <div class="fw-bold mb-1" style="border-bottom: 1px dashed #ccc; padding-bottom:3px;">âœï¸ Logic Check</div>

                                    {% if q.reading_type == 'TOPIC' %}
                                        <div class="mb-1">â‘  ì†Œì¬: <span style="display:inline-block; border-bottom:1px solid #000; width:70%;"></span></div>
                                        <div class="mb-1">â‘¡ ì£¼ì œë¬¸: <span style="display:inline-block; border-bottom:1px solid #000; width:65%;"></span></div>
                                        <div>â‘¢ ìš”ì•½: <span style="display:inline-block; border-bottom:1px solid #000; width:70%;"></span></div>
                                    
                                    {% elif q.reading_type == 'LOGIC' %}
                                        <div class="mb-1">â‘  ë‹¨ì„œ(Signal): <span style="display:inline-block; border-bottom:1px solid #000; width:50%;"></span></div>
                                        <div class="mb-3">â‘¡ ì—°ê²°/ë‹¨ì ˆ ì´ìœ : ___________________</div>

                                    {% elif q.reading_type == 'BLANK' %}
                                        <div class="mb-1">â‘  ë¹ˆì¹¸ ëª©í‘œ: _______________________</div>
                                        <div class="mb-1">â‘¡ ê·¼ê±° ë¬¸ì¥ í•´ì„:</div>
                                        <div style="border-bottom:1px solid #000; height:15px; width:100%;"></div>

                                    {% elif q.reading_type == 'DETAIL' %}
                                        <div class="mb-1">â‘  ê·¼ê±° ë¬¸ì¥ í•´ì„:</div>
                                        <div style="border-bottom:1px solid #000; height:15px; width:100%; margin-bottom:5px;"></div>
                                        <div>â‘¡ ì˜¤ë‹µ ê³ ì¹˜ê¸°: <span style="display:inline-block; border-bottom:1px solid #000; width:50%;"></span></div>

                                    {% else %}
                                        <div class="text-muted small">í•µì‹¬ ë‚´ìš© ì •ë¦¬:</div>
                                        <div style="border-bottom:1px solid #ccc; height:20px;"></div>
                                    {% endif %}
                                </div>
                            {% endif %} {% if q.reading_type == 'STRUCT' %}
                                <div class="text-muted small mt-2">
                                    â€» ìœ„ ë¬¸ì¥ì˜ êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ê³  í•´ì„í•˜ì‹œì˜¤.
                                </div>
                            {% endif %}

                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="page">
            <div class="d-flex justify-content-between border-bottom border-2 border-dark mb-4 pb-2">
                <h4 class="fw-bold m-0">Answer Key</h4>
                <span class="text-muted">ì±„ì ìš© ì •ë‹µì§€</span>
            </div>

            <div class="row">
                {% for q in questions %}
                    <div class="col-6 mb-4" style="page-break-inside: avoid;">
                        <div class="fw-bold mb-1">Q{{ forloop.counter }} ì •ë‹µ</div>
                        {% if q.answer_image %}
                            <img src="{{ q.answer_image.url }}" class="img-fluid border" style="max-height: 200px;">
                        {% else %}
                            <div class="text-muted small p-2 bg-light border">í•´ì„¤ ì—†ìŒ</div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>

    </div>

</body>
</html>