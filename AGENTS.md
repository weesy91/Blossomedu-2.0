# 작업 완료 내역 (Agents Report)

## 📅 2026-01-22: 선생님 플래너 및 학습 기록 버그 수정

### 1. 선생님 플래너/홈 화면 일정 동기화
- **증상**: 보강(Makeup) 또는 수업 이동(Reschedule) 내역이 플래너와 메인 화면('오늘의 수업')에 누락되는 현상 발견.
- **원인**: 
  - Backend: `StudentProfileSerializer`에서 담당 선생님 여부에 따라 `temp_schedules`를 과도하게 필터링.
  - Frontend (`teacher_home_screen.dart`): 정규 수업(`class_times`)만 표시하고 변경 사항을 반영하는 로직 부재.
- **해결**:
  - Backend: Serializer 필터링을 완화하여 모든 임시 스케줄 반환.
  - Frontend: 플래너의 로직을 홈 화면에도 이식하여, 변경된 수업을 '취소' 처리하고 보강 수업을 '추가'하여 표시.

### 2. 선생님 플래너 모바일 레이아웃 개선
- **문제**: 갤럭시 S24 울트라 등 모바일 기기에서 학생 정보 텍스트가 좁은 공간에 갇혀 세로로 한 글자씩 출력됨.
- **해결**: 학생 정보와 액션 버튼을 가로(Row) 배치에서 **세로(Column) 배치**로 구조를 변경하여, 좁은 화면에서도 충분한 텍스트 공간을 확보.

### 3. 학생 학습 기록 불통(FAIL) 오류 수정
- **문제**: 단어 테스트 점수가 총점의 90% 이상임에도(예: 29/30), 절대 점수 90점 미만이면 '불통'으로 표시됨.
- **해결**: `home_screen.dart`의 통과 기준을 절대 점수(`< 90`)에서 퍼센트 비율(`score < total * 0.9`)로 수정.

### 4. 기타 버그 수정 및 개선
- **학생 To-Do 리스트**: 과제 제출 후 홈 화면 복귀 시 상태가 '검토중'으로 즉시 갱신되지 않던 문제 해결 (데이터 리로드 추가).
- **학생 ID 관리**: 강사 앱에서 학생 ID 수정 기능 검증 및 UI 스타일(섹션 타이틀 패턴) 통일.

### 5. 웹 빌드 및 배포
- **Release Build**: 수정 사항(플래너, 홈, 레이아웃 등) 전체 반영 후 Web Release 빌드 생성.
- **Deployment**: Git Push를 통해 배포 완료.

### 6. 밀린 과제 (Makeup Task) 시스템 도입
- **문제**: 기한이 지난 과제들이 홈 화면에 쌓여 학생들의 학습 의욕을 저하시키는 문제 ('부채감' 형성).
- **해결 (Hybrid Strategy)**:
  - **7일 컷오프**: 마감일(또는 수업일) 기준 7일이 지난 과제는 홈 화면 '오늘의 할 일'에서 숨김 처리.
  - **보충 학습 페이지 (`/student/makeup-tasks`)**: 7일 이상 경과한 과제만 모아볼 수 있는 전용 페이지 신설.
  - **배너 알림**: 플래너 상단에 "지난 주차 미완료 과제가 N개 있습니다"라는 빨간색 배너를 표시하여 필요시 접근 유도.
  - **Backend**: `AssignmentTaskSerializer`에 `origin_log_date` 필드 추가하여 기준일 명확화.

### 7. 단어 테스트 UI/UX 고도화
- **문제**: 모바일 키보드가 올라올 때 단어/타이머가 가려지거나, 다음 문제 진행 시 키보드가 내려갔다 올라오는 깜빡임 현상 발생.
- **해결**:
  - **레이아웃 재배치**: 상단 타이머를 하단으로 이동하여 문제 텍스트 공간 확보.
  - **스크롤 개선**: 학습 모드(카드 넘기기)에서는 스크롤 방향을 정상화(`reverse: false`)하여 자연스러운 UI 제공.
  - **포커스 최적화**: 정답 제출 후 1초 대기 시간에도 키보드 포커스를 강제로 유지하여 깜빡임 제거 (`AutoFocus` + `Key` 적용).
  - **군더더기 제거**: 테스트 모드에서 불필요한 하단 '다음' 버튼 삭제 및 입력창 내 '전송' 아이콘 추가로 심플한 화면 구현.

---
## 📅 2026-01-21: 메시지 기능 구현 및 기타 버그 수정

### 1. 메시지(채팅) 기능 신규 구현
**목표**: 학생 ↔ 담당 선생님(구문/독해/특강) 간 1:1 채팅 기능 구현

**구현 내용**:
- **Backend**:
  - `messaging` Django 앱 신설 (`Conversation`, `Message` 모델)
  - REST API: 대화 목록 조회, 메시지 조회/전송, 읽음 처리
  - 담당 선생님 배정 시 대화방 자동 생성 (Django Signal)
  - 기존 학생 일괄 대화방 생성 커맨드 (`create_conversations`)
- **Frontend**:
  - `ChatListScreen`: 대화 목록, 학교/학년 표시, 안 읽은 메시지 배지
  - `ChatRoomScreen`: 채팅방 UI, 메시지 버블, 읽음 표시, Polling
  - FAB 버튼에 안 읽은 메시지 수 배지 (30초 자동 갱신)
- **Nginx 설정**: `/messaging/` 경로 프록시 추가

### 2. 단어 과제 제목 자동 포맷팅 버그 수정
- **문제**: 숫자만 입력 시 "Day N 암기"로 자동 변환되던 문제
- **해결**: Regex 수정 및 불필요한 텍스트 제거

### 3. 과목별 과제 크로스링킹 버그 수정
- **문제**: 구문 과제가 독해 일지에 표시되던 문제
- **해결**: `origin_log_subject` 필드 추가 및 필터링 로직 적용

### 4. 이미지 업로드 최적화
- **Backend**: 업로드 용량 제한 50MB로 증설
- **Frontend**: 이미지 자동 압축 (Quality 70, MaxWidth 1920)

### 5. 학생 일지 제목 날짜 표시
- 일지 작성 시 AppBar에 날짜 표시 추가

---

## 📅 2026-01-20: 플래너/이벤트 단어장 이슈 대응 및 웹 빌드 반영

### 1. 선생님 플래너 타임라인
- **자동 스크롤 보정**: 최초 진입 시 오늘 날짜가 상단에 오도록 타임라인 초기 오프셋 + 렌더 이후 재시도 로직 추가.

### 2. 학생 플래너 과제 노출
- **단어 과제 오픈 조건 수정**: 마감일 하루 전부터 열리도록 date-only 기준 계산 적용.
- **중복 표시 제거**: 과제는 `due_date` 기준으로 매핑하고, `due_date`가 없을 때만 `start_date`를 사용하도록 정리.

### 3. 이벤트 단어장 관리 안정화
- **리스트/토글/삭제 안정화**: null/중복 ID 안전 처리 및 상태 동기화 개선.
- **분원 자동 지정 로직 개선**: 서버에서 요청에 `branch`가 없을 때만 자동 할당하도록 수정.

### 4. 웹 빌드/푸시
- **웹 빌드 및 배포용 산출물 갱신**: `build/web` 업데이트 후 git push 반영.

## 📅 2026-01-17: 학생 홈 화면 개편 및 학습 기록 기능 구현

### 1. 학습 기록 확인 (Study Records)
**목표**: 학생들이 자신의 단어 테스트 결과와 모의고사 성적, 그리고 선생님의 피드백을 앱 내에서 직접 확인할 수 있도록 함.

- **구현 내용**:
  - **Backend**: `MockExamSerializer` 개선 (선생님 코멘트 `note` 필드 추가), API 엔드포인트 경로 수정 (`/mock/api/v1/results/`).
  - **Frontend**: `StudyRecordScreen` 신설.
    - **탭 분리**: '단어 테스트'와 '모의고사' 결과를 탭으로 구분하여 표시.
    - **정렬**: 최신 날짜순 자동 정렬.
    - **새로고침**: 리스트 당겨서 새로고침(Pull-to-Refresh) 기능 추가.
    - **데이터 연동**: `VocabService`를 통해 내 성적 데이터 조회 및 표시.
  - **메뉴 연동**: 학생 **더보기(More)** 메뉴에 '학습기록 확인' 버튼 추가.

### 2. 학원 공지사항 시스템 (Academy Announcements)
**목표**: 학원 전체 공지사항을 앱 홈 화면에서 효과적으로 전달하고, 관리자가 쉽고 빠르게 공지를 등록할 수 있도록 함.

- **구현 내용**:
  - **Backend**: `Announcement` 모델 및 API 구현 (이미지 업로드 지원).
  - **Teacher App**: '학원 공지사항 관리' 메뉴 추가. 배너 이미지 및 텍스트 공지 등록/삭제 기능 구현.
  - **Student App**: 홈 화면 최상단에 공지사항 배너 배치. 
    - **Empty State**: 등록된 공지가 없을 경우 '등록된 공지사항이 없습니다'라는 안내 카드 표시.

### 3. 학생 홈 화면 리뉴얼 (Home Screen Redesign)
**목표**: 단순히 '오늘 할 일'만 보여주는 것을 넘어, 중요한 공지, 최근 성취, 그리고 긴급한 과제를 한눈에 파악할 수 있는 대시보드 형태로 개선.

- **구현 내용**:
  - **레이아웃 재구성**: 공지사항(상단) → 최근 학습 기록(중단) → 오늘의 과제(하단) 순으로 배치.
  - **최근 학습 기록 (Recent History)**:
    - 기존 '지난 과제 버튼'을 **가로 스크롤 카드 섹션**으로 업그레이드.
    - 최근 제출하거나 완료한 과제 4개를 카드 형태로 시각화.
    - '더보기 >' 버튼을 통해 전체 히스토리(`StudentAssignmentHistoryScreen`)로 이동 가능.
  - **오늘의 과제 (Today's To-Do)**:
    - **미제출/지각 강조**: 기한이 지난 미제출 과제를 리스트에 포함하고, **빨간색 하이라이트**와 '미제출' 태그를 달아 경각심을 주도록 개선.
    - **리스트 정렬**: 기한이 임박했거나 이미 지난 과제가 최상단에 오도록 정렬.
    - **UI 개선**: 섹션을 명확한 카드 박스 형태로 디자인하여 가독성 확보.

### ✅ 현재 상태
- [x] 학습 기록 API 연동 및 화면 구현 완료
- [x] 공지사항 관리(강사) 및 표시(학생) 기능 정상 동작
- [x] 학생 홈 화면 UI 리뉴얼 완료 (공지/최근기록/오늘할일)
- [x] 지각(Overdue) 과제 강조 및 '미제출' 태그 표시 확인됨

---

## 📅 2026-01-16 (오후): Teacher UI 리뉴얼 및 단어장 관리 고도화
### 1. 단어장 관리 UX 개선
- **수정 기능**: 기존 단어장의 제목, 설명, 출판사 등 메타데이터를 즉시 수정하는 `_showEditDialog`와 `VocabService.updateVocabBook` 구현.
- **분원 필터링**: 업로드/수정 시 '대상 분원' 선택에 따라 학교 목록이 자동 필터링되도록 UI 개선 (UX 효율성 증대).
- **이벤트 스코핑**: 랭킹 이벤트 단어장의 노출 범위를 특정 분원 또는 전체 지점으로 설정하는 기능 추가.

### 2. Teacher 앱 UI 리팩토링
- **더보기 화면**: 카드 중심의 디자인으로 전면 개편 (프로필 헤더, 그룹화된 메뉴 섹션).
- **네비게이션**: 하단 탭 바 '설정' → '더보기'로 명칭 및 아이콘(Grid) 변경.

---

## 📅 2026-01-16 (오전): 학생 일괄 등록 및 강사 계정 관리 안정화
- **학생 대량 등록**: `import_students` 커맨드를 통해 010 핸드폰 번호 기반 아이디로 학생 23명 마이그레이션 및 오염 데이터 정리.
- **강사 관리 디버깅**: 강사 상세 페이지에서 ID(username) 변경이 실제 DB에 반영되지 않던 오류 해결.

---

## 📅 2026-01-14: 수업 일지 스마트 싱크 및 Teacher UI 1차 개편
- **수업 일지 스마트 싱크**: 일지 수정 시 과제와 하위 항목들을 지능적으로 업데이트/생성/삭제하는 로직 구현.
- **Teacher UI 개편**: 학생 목록 화면에 검색, 필터 칩, 퀵 액션 버튼(일지 작성, 로그 보기) 추가.
- **학생 상세 탭 인터페이스**: 상세 페이지를 기본정보, 수업 일지, 과제, 단어 시험, 성적 탭으로 분리.

---

## 📅 2026-01-13: 계정 관리 및 비활성화 시스템
- **계정 상태 관리**: 학생/강사 계정의 `is_active` 상태 전환 및 완전 삭제 기능 구현.
- **UI 연동**: 상세 관리 화면에서 활성화 스위치 및 삭제 확인 다이얼로그 추가.

---

## 📅 2026-01-12: 단어장 가시성 로직 및 라이브러리 디버깅
- **단어장 필터링**: 지점/학교/학년 설정을 고려한 단어장 노출 로직 검증.
- **데이터 매핑**: 대시보드 통계(도서 수, 틀린 단어 수) 정확도 개선.

---

## 📌 TODO (향후 작업)

### 🔴 우선순위: 높음 (핵심 기능)
- [ ] **학생 로그 검색** - 수업/과제/단어 기록을 모아서 검색/조회 가능한 페이지 (선생님 더보기 메뉴)
- [ ] **담당강사 관리** - 원장: 당일 분원 전체 현황(출결/일지작성여부) 파악. 부원장: 담당 강사의 학생 현황 파악. 수업일지 기록 열람 기능 연동.
- [ ] **성적표 기능** - 학생별 수업일지, 단어 기록 등을 종합하여 성적표 생성 및 발송

### 🟡 우선순위: 중간
- [ ] **Push 알림 시스템** - Firebase FCM 연동 (iOS/Android 앱 배포 시)
- [ ] **iOS/Android 앱 스토어 배포** - TestFlight, Play Store 등록
- [ ] **학부모 연동 자동 알림톡 시스템** - 출결/성적 알림
- [ ] **통계 대시보드 시각화** - 학생별/반별 성적 추이 그래프
- [ ] **수업 일지 PDF 내보내기** - 월간/주간 리포트 생성
- [ ] **모의고사 OMR 자동 인식** - OMR카드 PDF 파일 인식 및 성적 자동 입력

### 🟢 우선순위: 낮음 (편의 기능)
- [ ] **프로필 사진 업로드** - 학생/선생님 프로필 이미지 설정
- [ ] **다크 모드 지원** - 앱 전체 테마 설정
- [ ] **오프라인 모드** - 인터넷 없이 기본 기능 사용

### ✅ 완료된 항목
- [x] 과제 제출 Backend API 검증
- [x] 메시지(채팅) 기능 구현
- [x] 안 읽은 메시지 배지 표시


